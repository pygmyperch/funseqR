% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/loci_traceability.R
\name{trace_enriched_terms_to_loci}
\alias{trace_enriched_terms_to_loci}
\title{Trace enriched GO terms back to genomic loci}
\usage{
trace_enriched_terms_to_loci(
  con,
  enrichment_results,
  candidate_file_id,
  blast_param_id = NULL,
  significance_threshold = 0.05,
  include_blast_metrics = TRUE
)
}
\arguments{
\item{con}{Database connection object}

\item{enrichment_results}{Data frame or list of enrichment results from GO analysis}

\item{candidate_file_id}{Integer. File ID of the candidate dataset used in enrichment analysis}

\item{blast_param_id}{Integer. Optional. Specific BLAST run ID to trace.
If NULL, uses all available annotations. Default is NULL.}

\item{significance_threshold}{Numeric. FDR threshold for selecting significant terms. Default is 0.05}

\item{include_blast_metrics}{Logical. Include BLAST quality metrics in output. Default is TRUE}
}
\value{
Data frame with columns:
\itemize{
\item chromosome: Chromosome name
\item position: Genomic position
\item ref: Reference allele
\item alt: Alternative allele
\item go_id: GO term identifier
\item go_term: GO term description
\item go_category: GO category (BP, MF, CC)
\item gene_names: Associated gene names
\item uniprot_accession: UniProt accession
\item fold_enrichment: Enrichment fold change
\item p_adjusted: FDR-adjusted p-value
\item blast_evalue: BLAST e-value (if include_blast_metrics = TRUE)
\item blast_identity: BLAST percent identity (if include_blast_metrics = TRUE)
}
}
\description{
This function traces significantly enriched GO terms from enrichment analysis
back to the specific genomic loci (chromosome positions) that contributed to
the enrichment signal. This enables downstream analysis such as environmental
correlation mapping and validation of functional predictions.
}
\details{
This function traverses the complete annotation pipeline in reverse:
GO terms → annotations → BLAST results → flanking sequences → VCF entries

It can handle enrichment results from individual ontologies or combined results
from multiple ontologies. The function automatically identifies significantly
enriched terms and traces them back to contributing genomic loci.
}
\examples{
\dontrun{
# Trace enrichment results back to genomic loci
con <- connect_funseq_db("analysis.db")
enrich_res <- run_go_enrichment_workflow(con, "candidates.vcf")

# Trace BP enrichment to loci
bp_loci <- trace_enriched_terms_to_loci(con, enrich_res$enrichment_results$BP, 
                                        enrich_res$candidate_import$file_id)

# Trace combined results
all_results <- do.call(rbind, enrich_res$enrichment_results)
all_loci <- trace_enriched_terms_to_loci(con, all_results, 
                                         enrich_res$candidate_import$file_id)

# Use for environmental correlation
write.table(all_loci[, c("chromosome", "position", "ref", "alt")], 
            "enriched_loci.txt", row.names = FALSE)
}

}
